{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useState, useEffect } from 'react';\nimport { useSocket } from './useSocket.js';\nexport const useAnnouncements = () => {\n  _s();\n  const [announcements, setAnnouncements] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState('');\n  const {\n    socket\n  } = useSocket();\n  const API_BASE_URL = 'http://localhost:3001/api';\n  const fetchAnnouncements = async () => {\n    try {\n      setLoading(true);\n      const response = await fetch(`${API_BASE_URL}/announcements`);\n      const result = await response.json();\n      if (result.success) {\n        setAnnouncements(result.data);\n      } else {\n        setError('Failed to load announcements');\n      }\n    } catch (error) {\n      console.error('Error fetching announcements:', error);\n      setError('Error loading announcements');\n    } finally {\n      setLoading(false);\n    }\n  };\n  useEffect(() => {\n    fetchAnnouncements();\n\n    // Set up real-time listeners only if socket is connected\n    if (socket && socket.connected) {\n      console.log('游댋 Setting up announcement listeners...');\n      const handleNewAnnouncement = newAnnouncement => {\n        console.log('游닉 New announcement received:', newAnnouncement);\n        setAnnouncements(prev => [newAnnouncement, ...prev]);\n      };\n      const handleUpdatedAnnouncement = updatedAnnouncement => {\n        console.log('游닉 Announcement updated:', updatedAnnouncement);\n        setAnnouncements(prev => prev.map(ann => ann._id === updatedAnnouncement._id ? updatedAnnouncement : ann));\n      };\n      const handleDeletedAnnouncement = data => {\n        console.log('游닉 Announcement deleted:', data.id);\n        setAnnouncements(prev => prev.filter(ann => ann._id !== data.id));\n      };\n      socket.on('announcement_created', handleNewAnnouncement);\n      socket.on('announcement_updated', handleUpdatedAnnouncement);\n      socket.on('announcement_deleted', handleDeletedAnnouncement);\n      return () => {\n        console.log('游댋 Cleaning up announcement listeners...');\n        socket.off('announcement_created', handleNewAnnouncement);\n        socket.off('announcement_updated', handleUpdatedAnnouncement);\n        socket.off('announcement_deleted', handleDeletedAnnouncement);\n      };\n    }\n  }, [socket]); // Only depend on socket\n\n  return {\n    announcements,\n    loading,\n    error,\n    fetchAnnouncements\n  };\n};\n_s(useAnnouncements, \"KoPe2dHD8O/XiiJb/2X37vGhXJE=\", false, function () {\n  return [useSocket];\n});","map":{"version":3,"names":["useState","useEffect","useSocket","useAnnouncements","_s","announcements","setAnnouncements","loading","setLoading","error","setError","socket","API_BASE_URL","fetchAnnouncements","response","fetch","result","json","success","data","console","connected","log","handleNewAnnouncement","newAnnouncement","prev","handleUpdatedAnnouncement","updatedAnnouncement","map","ann","_id","handleDeletedAnnouncement","id","filter","on","off"],"sources":["C:/jbmmsi/client/src/hooks/useAnnouncements.js"],"sourcesContent":["import { useState, useEffect } from 'react';\r\nimport { useSocket } from './useSocket.js';\r\n\r\nexport const useAnnouncements = () => {\r\n  const [announcements, setAnnouncements] = useState([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState('');\r\n  const { socket } = useSocket();\r\n\r\n  const API_BASE_URL = 'http://localhost:3001/api';\r\n\r\n  const fetchAnnouncements = async () => {\r\n    try {\r\n      setLoading(true);\r\n      const response = await fetch(`${API_BASE_URL}/announcements`);\r\n      const result = await response.json();\r\n      \r\n      if (result.success) {\r\n        setAnnouncements(result.data);\r\n      } else {\r\n        setError('Failed to load announcements');\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching announcements:', error);\r\n      setError('Error loading announcements');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    fetchAnnouncements();\r\n\r\n    // Set up real-time listeners only if socket is connected\r\n    if (socket && socket.connected) {\r\n      console.log('游댋 Setting up announcement listeners...');\r\n\r\n      const handleNewAnnouncement = (newAnnouncement) => {\r\n        console.log('游닉 New announcement received:', newAnnouncement);\r\n        setAnnouncements(prev => [newAnnouncement, ...prev]);\r\n      };\r\n\r\n      const handleUpdatedAnnouncement = (updatedAnnouncement) => {\r\n        console.log('游닉 Announcement updated:', updatedAnnouncement);\r\n        setAnnouncements(prev => \r\n          prev.map(ann => \r\n            ann._id === updatedAnnouncement._id ? updatedAnnouncement : ann\r\n          )\r\n        );\r\n      };\r\n\r\n      const handleDeletedAnnouncement = (data) => {\r\n        console.log('游닉 Announcement deleted:', data.id);\r\n        setAnnouncements(prev => \r\n          prev.filter(ann => ann._id !== data.id)\r\n        );\r\n      };\r\n\r\n      socket.on('announcement_created', handleNewAnnouncement);\r\n      socket.on('announcement_updated', handleUpdatedAnnouncement);\r\n      socket.on('announcement_deleted', handleDeletedAnnouncement);\r\n\r\n      return () => {\r\n        console.log('游댋 Cleaning up announcement listeners...');\r\n        socket.off('announcement_created', handleNewAnnouncement);\r\n        socket.off('announcement_updated', handleUpdatedAnnouncement);\r\n        socket.off('announcement_deleted', handleDeletedAnnouncement);\r\n      };\r\n    }\r\n  }, [socket]); // Only depend on socket\r\n\r\n  return {\r\n    announcements,\r\n    loading,\r\n    error,\r\n    fetchAnnouncements\r\n  };\r\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}